<!--pages/inviteShare/inviteShare.wxml-->
<!-- <tabBar_top navbarData="{{navbarData}}"></tabBar_top> -->
<!-- wx:if="{{!userData.isNewMember}}" -->
<wxs src="../../utils/util.wxs" module="util" />
<!-- <image src='{{imgUrl}}invite/couponHeader.png' class='couponHeader'></image> -->
<view class='netWork fadeIn animated' wx:if='{{!IsshowNetStatus}}'>
  <text class='iconicon-test5 iconfont netWorkImg'></text>
  <text class='netWorkCont'>当前网络不可用，请检查你的网络设置</text>
</view>
<block wx:if="{{!userData.isNewMember}}">
  <view>
    <view class="banner">
      <image src="{{inviteMember.config.banner1}}" class='fadeIn animated'/>
      <!-- <view class="qrcode" wx:if="{{qrcode}}">
        <image src="{{qrcode}}" class='fadeIn animated' />
        <text>点击保存并分享</text>
      </view> -->
    </view>

    <view class="content">
      <view class="return-course">
        <text>返回约课</text>
        <image src="{{imgUrl}}invite/icon_arrow_right.png" />
        <button open-type='getUserInfo' class='couponRightButton' bindgetuserinfo = 'handleReturnCourseTap' data-path='pages/index/index'></button>
      </view>

      <view class="invite-wrapper fadeIn animated" wx:if="{{inviteMember.name && !isShare}}">
        <image class="invite-avatar" wx:if='{{inviteMember.head_img}}' src="{{inviteMember.head_img}}" />
        <image class="invite-avatar"wx:elif='{{!inviteMember.head_img}}' src="{{imgUrl}}invite/default_header.png" />
        <view class="invite-title-wrapper">
          <view class="invite-title"><text>{{inviteMember.name}}</text>{{inviteMember.config.info1}}</view>
          <view class="invite-subtitle">{{inviteMember.config.info2}}</view>
        </view>
      </view>

      <button class="invite-btn fadeIn animated" open-type='share' wx:if='{{userData.id}}'>立即邀请</button>
      <view wx:if='{{isShare}}' class="face-invite-btn" bindtap="handleFaceInviteBtnTap">面对面邀请</view>

      <view class="total-wrapper">
        <view class="total-amount">
          <!-- <loading invitedInfo = '{{!invitedInfo}}'></loading> -->
          <view class="total-number" wx:if='{{invitedInfo}}'>{{invitedInfo.invited_coupon_amount || 0}}<text class='dollor'>元</text></view>
          <view class="total-tips">代金券累计金额</view>
        </view>
        <view class="totle-line"></view>
        <view class="total-count">
          <!-- <loading invitedInfo = '{{!invitedInfo}}'></loading> -->
          <view class="total-number" wx:if='{{invitedInfo}}'>{{invitedInfo.invited_member_count || 0}}<text class='dollor'>人</text></view>
          <view class="total-tips">累计邀请人</view>
        </view>
      </view>

      <view class="invite-member-wrapper" wx:if="{{invitedInfo.invited_member_List.length}}">
        <view class="invite-member-title">
          <hr/>
          <view class="invite-member-count">已邀请好友<text>({{invitedInfo.invited_member_List.length}}人)</text></view>
          <hr/>
        </view>
        <view class="invite-member-list">
          <view class="invite-member-item" wx:for="{{invitedCouponList ||invitedInfo.invited_member_List}}" wx:key="index" wx:for-index='idx'>
            <image class="invite-member-avatar" wx:if='{{item.head_img}}' src="{{item.head_img}}" />
            <image class="invite-member-avatar"wx:elif='{{!item.head_img}}' src="{{imgUrl}}invite/MysteriousMan.png" />
            <view class="invite-member-name">{{item.nick_name || '神秘好友'}}</view>

            <loading invitedCouponList = '{{!invitedCouponList}}'></loading>
            <view wx:if='{{invitedCouponList[idx].sub_flag === 0 && invitedCouponList}}' class='remind'>提醒关注 <button class='remindBtn' open-type='share'></button> </view>
            <view wx:elif='{{invitedCouponList[idx].sub_flag === 1 && invitedCouponList}}' class='receiveCoupon'>已领取<text class='receiveCouponPrice'>{{invitedCouponList[idx].coupon_amount || 0}}元</text>券</view>
          </view>
        </view>
      </view>

    </view>

    <view class="tips">
      <view class="tips-title">【活动细则】</view>
      <rich-text nodes="{{shareCoupon.info}}"></rich-text>
    </view>

  </view>
</block>

<block wx:else>
  <view style="position:relative;margin-top:{{marginTopBar}}px;">
    <view class="header-background">
      <image src="{{inviteMember.config.banner2}}" />
    </view>
    <view class="center-background"></view>
    <view class="center-content">
      <image class="center-avatar" src="{{inviteMember.head_img}}" />
      <view class="center-name"><text class='inviteName'>{{inviteMember.name || "J&J"}}@ </text>带你1小时变瘦变美
      </view>
      <!-- 未领取 -->
      <!-- <view class='center-text' wx:if='{{userData.isNewMember && !isReceiveState}}'>送你50元新手礼券，一起来健身吧！</view> -->
      <view class='centerText' wx:if='{{userData.isNewMember && !isReceiveState}}'>      <text class='iconxingzhuang iconfont point'></text>
        <view class='centerText2'>
           <view class='centerText2'>首次上课仅<text class='dollor2'>39</text>元 </view>
           <text class='centerText3'>关注公众号</text>再送<text class='dollor2'>50</text>元代金券
        </view>
        <text class='iconxingzhuang- iconfont point2'></text>
      </view>
      <view class='courseBtn'>立即约课
         <button class='couponRightButton' open-type='getUserInfo' bindgetuserinfo = 'handleReturnCourseTap'></button>
      </view>
    </view>
  </view>
</block>

<van-popup show="{{ showShareState }}" 
           bind:click-overlay='onCloseShareImg' 
           catchtouchmove="{{true}}" 
           safe-area-inset-bottom 
           custom-style='margin-top:-120rpx'>
    <view class='PostImgBox'>
      <view class='poste_box' id='canvas-container' style='width:100%;height:100%;;overflow:hidden'>
        <canvas canvas-id="myCanvas" style="width:100%;height:100%;overflow:hidden" class='fadeIn animated' wx:if='{{showShareState}}'/>
      </view>
      <view class='sharePostBtn' bindtap='savePostLocation'>保存本地</view>
    </view>
</van-popup>

<van-popup show="{{ isShadeShow }}" 
           bind:click-overlay='onClose' 
           catchtouchmove="{{true}}" 
           safe-area-inset-bottom 
           custom-style='margin-top:-120rpx;background:none;border-radius:16rpx;'>
  <view class='inviteYou'>
     <view class='lineBox'>
       <view class='line1'></view>
       <view class='ball'></view>
     </view>
     <text class='inviteYouText'>邀请有礼</text>
     <view class='lineBox'>
       <view class='ball'></view>
       <view class='line2'></view>
     </view>
  </view>
  <view class='qrcodeBox'>
    <image src="{{qrcode}}"  class='qrcodeImg'/>
  </view>
  <view class='qrcode-tipsBox'>
    <image src='{{imgUrl}}invite/shareImgBottom.png' class='qrcode-tipsImg'></image>
    <view class='textBox'>
      <text class="text" decode="true"><text class='textNew'>新用户扫码</text>\n领取共{{shareCoupon.amount}}元代金券</text>
    </view>
  </view>
  <image src='{{imgUrl}}invite/closeBtn.png' class='closeBtn' bindtap='onClose'></image>
</van-popup>

<jurisdictionPopup state = '{{jurisdictionState}}'
                   bindmyevent='bindgetuserinfo'></jurisdictionPopup>





